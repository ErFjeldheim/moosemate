schemaVersion: 2.2.0
metadata:
  name: moosemate
  version: 1.0.0
  displayName: MooseMate Application
  description: A JavaFX application with Spring Boot REST API and Maven
  tags:
    - Java
    - JavaFX
    - Spring Boot
    - Maven
  projectType: maven
  language: java
  provider: Red Hat
  supportUrl: https://github.com/eclipse/che

components:
  - name: tools
    container:
      image: eclipse-temurin:21-jdk
      memoryLimit: 4Gi
      memoryRequest: 2Gi
      cpuLimit: 2000m
      cpuRequest: 1000m
      mountSources: true
      env:
        - name: JAVA_HOME
          value: /usr/lib/jvm/java-21-openjdk
        - name: MAVEN_OPTS
          value: -Xmx2048m
      endpoints:
        - name: rest-api
          targetPort: 8080
          exposure: public
          protocol: http
        - name: debug
          targetPort: 5005
          exposure: internal
          protocol: tcp

commands:
  - id: maven-build
    exec:
      label: "Maven: Build"
      component: tools
      workingDir: ${PROJECT_SOURCE}/moosemate
      commandLine: mvn clean install
      group:
        kind: build
        isDefault: true

  - id: maven-test
    exec:
      label: "Maven: Test"
      component: tools
      workingDir: ${PROJECT_SOURCE}/moosemate
      commandLine: mvn test

  - id: maven-clean
    exec:
      label: "Maven: Clean"
      component: tools
      workingDir: ${PROJECT_SOURCE}/moosemate
      commandLine: mvn clean

  - id: maven-package
    exec:
      label: "Maven: Package"
      component: tools
      workingDir: ${PROJECT_SOURCE}/moosemate
      commandLine: mvn package

  - id: run-rest-api
    exec:
      label: "Run: REST API"
      component: tools
      workingDir: ${PROJECT_SOURCE}/moosemate/rest
      commandLine: mvn spring-boot:run
      group:
        kind: run
        isDefault: false

  - id: run-ui
    exec:
      label: "Run: JavaFX UI"
      component: tools
      workingDir: ${PROJECT_SOURCE}/moosemate/ui
      commandLine: mvn javafx:run
      group:
        kind: run
        isDefault: true

  - id: debug-rest-api
    exec:
      label: "Debug: REST API"
      component: tools
      workingDir: ${PROJECT_SOURCE}/moosemate/rest
      commandLine: mvn spring-boot:run -Dspring-boot.run.jvmArguments="-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005"
      group:
        kind: debug

  - id: checkstyle
    exec:
      label: "Quality: Checkstyle"
      component: tools
      workingDir: ${PROJECT_SOURCE}/moosemate
      commandLine: mvn checkstyle:check

  - id: spotbugs
    exec:
      label: "Quality: SpotBugs"
      component: tools
      workingDir: ${PROJECT_SOURCE}/moosemate
      commandLine: mvn spotbugs:check

  - id: jacoco-report
    exec:
      label: "Quality: JaCoCo Coverage Report"
      component: tools
      workingDir: ${PROJECT_SOURCE}/moosemate
      commandLine: mvn jacoco:report

events:
  postStart:
    - maven-build
